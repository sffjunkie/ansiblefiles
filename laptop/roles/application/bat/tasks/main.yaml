---
- name: Bat | Install
  ansible.builtin.package:
    name: bat
    state: present

- name: Bat | Update aliases
  block:
    - name: Bat | Add alias as the executable is named batcat on debian
      when: os_family == 'debian'
      ansible.builtin.set_fact:
        _bat_aliases: ['cat', 'batcat']

    - name: Bat | If not debian add alias to bat
      when: os_family != 'debian'
      ansible.builtin.set_fact:
        _bat_aliases: ['cat', 'bat']

    - name: Bat | Calc new output_config
      ansible.utils.update_fact:
        updates:
          - path: "output_config.user[{{ user_idx_app }}].aliases"
            value: >-
              {{ output_config.user[user_idx_app].aliases +
              [_bat_aliases] }}
      register: _updated_fact
      changed_when: false

    - name: Bat | Update output_config
      ansible.builtin.set_fact:
        output_config: "{{ _updated_fact.output_config }}"
      changed_when: false
