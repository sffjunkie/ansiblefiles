---
- hosts: all
  become: true
  become_user: "{{ username }}"
  vars_files:
    - ../vars/_playbook.yaml
    - ../vars/secrets.yaml

  pre_tasks:
    - name: Debug
      ansible.builtin.debug:
        msg:
          - "Computed stats"
          - "  Configuration file home directory: {{ config_home }}"
          - "  Shell: {{ shell }}"
          - "  Distribution: {{ distribution }}"
          - "  OS Family: {{ os_family }}"
          - "  Development Environments: {{ dev_roles | join(', ') }}"

  roles:
    - git
    - dev
  #   - role: xdg_user_dirs
  #     vars:
  #       custom_xdg_user_dirs:
  #         XDG_PUBLICSHARE_DIR:
    - docker

  tasks:
    - name: Install zsh.
      when: machine.shell == 'zsh'
      include_role:
        name: zsh

    - name: Install oh-my-zsh.
      when: machine.shell == 'zsh' and machine.ohmyzsh.path | length > 0
      include_role:
        name: ohmyzsh

    - name: Install Go dev environment.
      when: '"go" in development_roles'
      include_role:
        name: development_go

    - name: Install Node dev environment.
      when: '"node" in development_roles'
      include_role:
        name: development_node

    - name: Install Python dev environment.
      when: '"python" in development_roles'
      include_role:
        name: development_python

    - name: Install Rust dev environment.
      when: '"rust" in development_roles'

      include_role:
        name: development_rust
  #   - name: Install config files
  #     ansible.builtin.git:
  #       repo: 'https://github.com/sffjunkie/configfiles'
  #       dest: "{{ config_home }}"
